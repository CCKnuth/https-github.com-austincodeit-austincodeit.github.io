$(document).ready(function(){let openDataLink='https://data.austintexas.gov/resource/czdh-pagu.json';let openData;$.ajax({url:openDataLink,type:"GET",data:{"$limit":7000,"$$app_token":"AmHlGm0OHBl6r4hg0PLvAtJk7"}}).done(function(data){let nameArray=_.chain(data).pluck('assigneduser').uniq().value();let removeArray=['Todd Wilcox','Viola Ruiz','Marcus Elliott','Tammy Lewis','Kendrick Barnett',];let filterArray=nameArray.filter(function(name){if(removeArray.indexOf(name)<0){return name;}})
$("#inspectorID").autocomplete({source:filterArray});openData=data;});function dateFormatting(datestring){let _d=new Date(datestring);let yr=_d.getFullYear();let mth=_d.getMonth()+1;let day=_d.getDate();if(isNaN(yr)){return'';}else{return mth+"/"+day+"/"+yr;}}
function nullCheck(string){if(string){return string;}else{return'';}}
$("#loadTaskList").on('click',function(){$("#availableAddressRows").html("");let chosenName=$("#inspectorID").val().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").trim()
if($("#inspectorID").val().length>=2){$("#inspectorID").val('');}
global_pdf.name=chosenName;global_pdf.datestamp=dateFormatting(Date.now());global_pdf.timestamp=new Date().toLocaleTimeString();let filteredData=_.filter(openData,function(row){return row.assigneduser==chosenName;})
let uniqueAddressArray=[],filteredAddressArray=[],addCheck;$(filteredData).each(function(i){$("#availableAddressRows").append('<tr>'+'<td class="first">'+nullCheck(filteredData[i].type)+'</td>'+'<td class="b" id='+nullCheck(filteredData[i].foldernumber)+'>'+nullCheck(filteredData[i].foldernumber)+'</td>'+'<td class="c" id="location">'+nullCheck(filteredData[i].foldername)+'</td>'+'<td class="a">'+nullCheck(filteredData[i].priority1)+'</td>'+'<td class="a">'+nullCheck(filteredData[i].priority2)+'</td>'+'<td class="a">'+dateFormatting(filteredData[i].duetostart)+'</td>'+'<td class="a">'+dateFormatting(filteredData[i].duetoend)+'</td>'+'<td class="c">'+nullCheck(filteredData[i].peoplename)+'</td>'+'<td class="c">'+nullCheck(filteredData[i].housenumber)+' '+nullCheck(filteredData[i].streetname)+'</td>'+'</tr>');addCheck=filteredData[i].foldername;if((nullCheck(addCheck).length>1)&&(uniqueAddressArray.indexOf(addCheck)<0)){uniqueAddressArray.push(addCheck);filteredAddressArray.push(filteredData[i])}});let filteredAndSortedArray=_.sortBy(filteredAddressArray,function(row){return row.type;})
mapTaskListItem(filteredAndSortedArray);$('#availableAddressTable').trigger('update');$window.trigger('resize');$('#availableAddressRows > tr').children("td.first").prepend(''+'<a type="button" class="btn btn-sm btn-default mobileAdd">'+'<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>'+'</a>');validateAddButton();});$(document).keypress(function(e){if(e.which==13&&$("#inspectorID:focus").val()){if($("#inspectorID:focus").val().length>=2){$("#loadTaskList").trigger("click");}}});let $window=$(window);$window.resize(function resize(){$draggableTable1=$('#availableAddressRows > tr');$draggableTable2=$('#routableAddressRows > tr');$mobileAddButton=$('#availableAddressRows > tr > td.first > a');if($window.width()<768){$mobileAddButton.addClass('mobileAdd');$draggableTable1.addClass('mobile');return $draggableTable2.addClass('mobile');}
$mobileAddButton.removeClass('mobileAdd');$draggableTable1.removeClass('mobile');$draggableTable2.removeClass('mobile');}).trigger('resize');let validateAddButton=function(){$("a.mobileAdd").unbind('click').bind('click',function(elem){let $tableRow=$(this).parent().parent()[0];let newAddress=$($tableRow).children("td#location").text().trim()+", Austin, TX";let popUpText=$($tableRow).children("td#location").text().trim();$activeElement=$($tableRow).children("td#location");$("#routableAddressRows").append('<tr>'+'<td class="first"><span id="count"></span>'+'<button type="button" class="btn btn-sm btn-default removeAddress">'+'<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>'+'</button>'+$($tableRow).children("td:nth-child(1)").text()+'</td>'+'<td class="b">'+$($tableRow).children("td:nth-child(2)").text()+'</td>'+'<td class="b">'+$($tableRow).children("td:nth-child(3)").text()+'</td>'+'<td class="c" id="location">'+$($tableRow).children("td:nth-child(4)").text()+'</td>'+'<td class="a">'+$($tableRow).children("td:nth-child(5)").text()+'</td>'+'<td class="a">'+$($tableRow).children("td:nth-child(6)").text()+'</td>'+'<td class="a">'+$($tableRow).children("td:nth-child(7)").text()+'</td>'+'<td class="a">'+$($tableRow).children("td:nth-child(8)").text()+'</td>'+'<td class="c">'+$($tableRow).children("td:nth-child(9)").text()+'</td>'+'<td class="c">'+$($tableRow).children("td:nth-child(10)").text()+'</td>'+'</tr>');$activeElement=$("#routableAddressRows > tr:not(.placeholder):last-child").children("td#location");global_func.validateRemoveButton();global_func.adjustRowCount();global_func.placeAddressOnMap(newAddress,popUpText,false);});};global_pdf.name='';global_pdf.datestamp=dateFormatting(Date.now());global_pdf.timestamp=new Date().toLocaleTimeString();});