var map;$(document).ready(function(){let openDataLink='https://data.austintexas.gov/resource/673d-jv2y.json';$.ajax({url:openDataLink,type:"GET",data:{"$limit":2000,"$$app_token":"n89g7s9iUyusfWDEHDHMtGcVT"}}).done(function(data){let strTypeCount=_.countBy(data,'str_type');let zipCodeCount=_.countBy(data,'prop_zip');let addressCount=_.countBy(data,'prop_address');let strTypeValues=_.values(strTypeCount);let strTypeKeys=_.keys(strTypeCount);let zipValues=_.values(zipCodeCount);let zipKeys=_.keys(zipCodeCount);let addressKeys=_.keys(addressCount);$("#full-count").html(data.length);let bscCount=0,citeCount=0,inspectCount=0,novCount=0,warningCount=0,nullCount=0;let activityTypeChart=Highcharts.chart('container-type',{chart:{type:'bar'},title:{text:'STRs by Type'},xAxis:{categories:strTypeKeys},yAxis:{title:{text:''}},series:[{name:['Total Count'],data:strTypeValues,dataLabels:{enabled:true,align:'right',style:{}}}]});let zipCountChart=Highcharts.chart('container-zip',{chart:{type:'column'},title:{text:'STRs by Zip Code'},xAxis:{categories:zipKeys},yAxis:{title:{text:''}},series:[{name:['Total Count'],data:zipValues,dataLabels:{enabled:true,align:'right',style:{}}}]});const API_KEY='AIzaSyBbnhwYIXT-MBTVIaDxS9kzbqIOmoeqcRU'
geocoder=new google.maps.Geocoder();function addMarker(location,popUpText){let cityCircle=new google.maps.Circle({strokeColor:'#FF0000',strokeOpacity:0.8,strokeWeight:2,fillColor:'#FF0000',fillOpacity:0.35,map:map,center:location,radius:200});let infoWindow=new google.maps.InfoWindow({content:popUpText});google.maps.event.addListener(cityCircle,'click',function(ev){infoWindow.setPosition(ev.latLng);infoWindow.open(map);});}
let addressCleaned=addressKeys.map(function(elem){return elem.substring(9,elem.length).trim()+", Austin, TX";});let i=0;let secondTry=[];let secondTryKeys=[];function addressLoop(){geocoder.geocode({'address':addressCleaned[i]},function(results,status){if(status==google.maps.GeocoderStatus.OK){addMarker(results[0].geometry.location,addressKeys[i]);if(i<addressCleaned.length){setTimeout(addressLoop,500);i=i+1;}}else if(status==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(addressLoop,2500);}else{}});}
addressLoop();});let initialize=function(){if(typeof google!=='object'){setTimeout(function(){initialize();},1000)}
let myLatlng=new google.maps.LatLng(30.2764099,-97.7507724);let mapOptions={zoom:13,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP}
map=new google.maps.Map(document.getElementById('google-map'),mapOptions);google.maps.event.addDomListener(window,"resize",function(){var center=map.getCenter();google.maps.event.trigger(map,"resize");map.setCenter(center);});}
initialize();});